
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="test_register_inheritance_via_derived_from.html">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.4">
    
    
      
        <title>test_size_inheritance_and_adjustment - Test Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#test_size_inheritance_and_adjustment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Test Documentation" class="md-header__button md-logo" aria-label="Test Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Test Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              test_size_inheritance_and_adjustment
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Test Documentation" class="md-nav__button md-logo" aria-label="Test Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Test Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="test_derived_from_path_resolving.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_derived_from_path_resolving
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="test_development.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_development
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="test_application_of_default_values.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_application_of_default_values
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="test_cluster_inheritance_via_derived_from.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_cluster_inheritance_via_derived_from
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="test_dim_handling.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_dim_handling
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="test_enumerated_values.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_enumerated_values
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="test_enumerated_values_copy_via_derived_from.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_enumerated_values_copy_via_derived_from
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="test_field_inheritance_via_derived_from.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_field_inheritance_via_derived_from
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="test_logical_integrity.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_logical_integrity
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="test_peripheral_inheritance_via_derived_from.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_peripheral_inheritance_via_derived_from
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="test_register_inheritance_via_derived_from.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_register_inheritance_via_derived_from
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    test_size_inheritance_and_adjustment
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="test_size_inheritance_and_adjustment.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    test_size_inheritance_and_adjustment
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tests.test_process.test_size_inheritance_and_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      test_size_inheritance_and_adjustment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests.test_process.test_size_inheritance_and_adjustment.test_complex_size_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      test_complex_size_adjustment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests.test_process.test_size_inheritance_and_adjustment.test_overlap_due_to_size_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      test_overlap_due_to_size_adjustment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests.test_process.test_size_inheritance_and_adjustment.test_simple_size_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      test_simple_size_adjustment
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tests.test_process.test_size_inheritance_and_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      test_size_inheritance_and_adjustment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests.test_process.test_size_inheritance_and_adjustment.test_complex_size_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      test_complex_size_adjustment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests.test_process.test_size_inheritance_and_adjustment.test_overlap_due_to_size_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      test_overlap_due_to_size_adjustment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tests.test_process.test_size_inheritance_and_adjustment.test_simple_size_adjustment" class="md-nav__link">
    <span class="md-ellipsis">
      test_simple_size_adjustment
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="test_size_inheritance_and_adjustment">test_size_inheritance_and_adjustment</h1>
<div class="doc doc-object doc-module">
<a id="tests.test_process.test_size_inheritance_and_adjustment"></a>
<div class="doc doc-contents first">
<p>Contrary to what is defined in the CMSIS SVD standard, in <code>svdconv</code> the inheritance and adjustment of register sizes
follow a specific algorithm based on implicit and explicit size definitions at different levels. The calculation of the
<strong><em>effective size</em></strong> involves both <strong><em>explicit definitions</em></strong> and <strong><em>inheritance</em></strong> from higher levels, following a
recursive approach to determine the <strong><em>maximum size</em></strong> within each level. Here's how the algorithm works:</p>
<p>For each peripheral, if clusters are present, they are resolved <strong><em>from the inside out</em></strong>, starting with the innermost
clusters (where children are only registers). Each cluster is examined by iterating through all of its children—either
<strong><em>registers</em></strong> or <strong><em>subclusters</em></strong>. The effective size for a register is either <strong><em>explicitly defined</em></strong> or
<strong><em>inherited</em></strong> from a higher level, such as from the cluster, peripheral, or ultimately the device level. If no
explicit size is defined, it inherits the size from the levels above, taking the first size that is found while
traversing upwards. If this traversal reaches the device level and no size is defined there either, the size is set to
<strong><em>32 bits</em></strong> by default.</p>
<p>For a given cluster, its size is determined by finding the <strong><em>maximum size</em></strong> among all of its children, including both
registers and subclusters.</p>
<p>This process is repeated <strong><em>recursively</em></strong>, starting with the innermost clusters and moving outward to determine the
size of the parent clusters. Finally, the peripheral's size is calculated by taking the maximum size among all of its
direct children, including clusters and registers. This approach ensures that the effective size of a peripheral is
determined based on the largest size found in its entire hierarchy.</p>
<details> <summary><i>Python code that demonstrates the algorithm (click to expand)</i></summary>

```python from dataclasses import dataclass, field

@dataclass(kw_only=True) class Device: size: None | int = None name: str peripherals: list["Peripheral"] =
field(default_factory=list)

@dataclass(kw_only=True) class Peripheral: size: None | int = None name: str registers_clusters: list["Register |
Cluster"] = field(default_factory=list) parent: Device

@dataclass(kw_only=True) class Cluster: size: None | int = None name: str registers_clusters: list["Register | Cluster"]
= field(default_factory=list) parent: "Cluster | Peripheral"

@dataclass(kw_only=True) class Register: size: None | int = None name: str parent: "Cluster | Peripheral"

def resolve_size_over_levels(peripheral: Peripheral) -&gt; int: # Start resolving the size for the peripheral by examining
all its children inherited_size = resolve_inherited_size(peripheral) effective_size = inherited_size

for element in peripheral.registers_clusters: child_size = resolve_size(element, inherited_size) effective_size =
max(effective_size, child_size)

peripheral.size = effective_size return effective_size

def resolve_size(element: Register | Cluster, inherited_size: int) -&gt; int: # Determine effective size for Register or
Cluster if isinstance(element, Register): return element.size if element.size is not None else inherited_size

if isinstance(element, Cluster): return resolve_cluster_size(element)

raise ValueError("Element must be either Register or Cluster")

def resolve_cluster_size(cluster: Cluster) -&gt; int: # Start resolving the size for the cluster by examining all its
children cluster_inherited_size = resolve_inherited_size(cluster) effective_size = cluster_inherited_size

for child in cluster.registers_clusters: child_size = resolve_size(child, cluster_inherited_size) effective_size =
max(effective_size, child_size)

cluster.size = effective_size return effective_size

def resolve_inherited_size(element: Peripheral | Cluster | Register) -&gt; int: # Traverse upwards to find the first
defined size, or return 32 if no size is defined current = element.parent while current is not None: if current.size is
not None: return current.size current = getattr(current, "parent", None) return 32 # Default to 32 if no size is found
in any parent level

# Example usage: def print_hierarchy(element: Peripheral | Cluster | Register, path: str = ""): if isinstance(element,
Peripheral): path += element.name print(f"{path} (size: {element.size})") for child in element.registers_clusters:
print_hierarchy(child, path + ".") elif isinstance(element, Cluster): path += element.name print(f"{path} (size:
{element.size})") for child in element.registers_clusters: print_hierarchy(child, path + ".") elif isinstance(element,
Register): path += element.name print(f"{path} (size: {element.size})") else: raise ValueError("Element must be either
Peripheral, Cluster or Register")

device = Device(name="DeviceA") peripheral_a = Peripheral(name="PeripheralA", parent=device)

cluster_a = Cluster(name="ClusterA", parent=peripheral_a) register_a = Register(name="RegisterA", parent=cluster_a)
register_b = Register(name="RegisterB", parent=cluster_a) cluster_b = Cluster(name="ClusterB", parent=cluster_a)
register_a_in_cluster_b = Register(name="RegisterA", parent=cluster_b) register_b_in_cluster_b =
Register(name="RegisterB", size=64, parent=cluster_b) cluster_b.registers_clusters.extend([register_a_in_cluster_b,
register_b_in_cluster_b]) cluster_a.registers_clusters.extend([register_a, register_b, cluster_b])

cluster_c = Cluster(name="ClusterC", parent=peripheral_a) register_a_in_cluster_c = Register(name="RegisterA",
parent=cluster_c) register_b_in_cluster_c = Register(name="RegisterB", parent=cluster_c)
cluster_c.registers_clusters.extend([register_a_in_cluster_c, register_b_in_cluster_c])

register_a_in_peripheral = Register(name="RegisterA", parent=peripheral_a)

peripheral_a.registers_clusters.extend([cluster_a, cluster_c, register_a_in_peripheral])
device.peripherals.append(peripheral_a)

# Resolve sizes and print hierarchy resolve_size_over_levels(peripheral_a) print_hierarchy(peripheral_a) ```

</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="tests.test_process.test_size_inheritance_and_adjustment.test_complex_size_adjustment">
<code class="highlight language-python"><span class="n">test_complex_size_adjustment</span></code>
</h2>
<div class="doc doc-contents">
<p>This test examines how the parser handles more intricate scenarios of size inheritance and adjustments across
clusters and registers within a peripheral. The SVD file contains clusters and registers with varying degrees
of explicit and implicit size definitions. The parser must determine the correct effective sizes based on size
inheritance rules and adjustments at different levels. In this case, the sizes within the clusters and
registers are adjusted, either explicitly or inherited, following a recursive calculation of the maximum
effective size.</p>
<p><strong>Expected Outcome:</strong> The parser should process the file without errors, correctly inheriting and adjusting sizes
across clusters and registers. ClusterA, which has no explicit size defined, should have its size adjusted to
64 bits, inherited from ClusterB and its child registers. Both <code>RegisterA</code> and <code>RegisterB</code> within ClusterA
should also have effective sizes of 64 bits. Similarly, ClusterB should inherit a size of 64 bits from its
children, while ClusterC, which also lacks an explicit size, should have a final size of 32 bits, based on its
child registers, which inherit the size implicitly from device level (default value). Since the size
adjustment for ClusterC is executed before the final size adjustment for PeripheralA, at this point of time,
no size is set for PeripheralA. Finally, PeripheralA should adjust its size to 64 bits, reflecting the largest
size found in its children. The parser should handle all these size adjustments and inheritance steps
accurately, consistent with the behavior of <code>svdconv</code>.</p>
<p><strong>Processable with svdconv:</strong> yes</p>
<details class="quote">
<summary>Source code in <code>tests/test_process/test_size_inheritance_and_adjustment.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"error::svdsuite.process.ProcessWarning"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_complex_size_adjustment</span><span class="p">(</span><span class="n">get_processed_device_from_testfile</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Device</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    This test examines how the parser handles more intricate scenarios of size inheritance and adjustments across</span>
<span class="sd">    clusters and registers within a peripheral. The SVD file contains clusters and registers with varying degrees</span>
<span class="sd">    of explicit and implicit size definitions. The parser must determine the correct effective sizes based on size</span>
<span class="sd">    inheritance rules and adjustments at different levels. In this case, the sizes within the clusters and</span>
<span class="sd">    registers are adjusted, either explicitly or inherited, following a recursive calculation of the maximum</span>
<span class="sd">    effective size.</span>

<span class="sd">    **Expected Outcome:** The parser should process the file without errors, correctly inheriting and adjusting sizes</span>
<span class="sd">    across clusters and registers. ClusterA, which has no explicit size defined, should have its size adjusted to</span>
<span class="sd">    64 bits, inherited from ClusterB and its child registers. Both `RegisterA` and `RegisterB` within ClusterA</span>
<span class="sd">    should also have effective sizes of 64 bits. Similarly, ClusterB should inherit a size of 64 bits from its</span>
<span class="sd">    children, while ClusterC, which also lacks an explicit size, should have a final size of 32 bits, based on its</span>
<span class="sd">    child registers, which inherit the size implicitly from device level (default value). Since the size</span>
<span class="sd">    adjustment for ClusterC is executed before the final size adjustment for PeripheralA, at this point of time,</span>
<span class="sd">    no size is set for PeripheralA. Finally, PeripheralA should adjust its size to 64 bits, reflecting the largest</span>
<span class="sd">    size found in its children. The parser should handle all these size adjustments and inheritance steps</span>
<span class="sd">    accurately, consistent with the behavior of `svdconv`.</span>

<span class="sd">    **Processable with svdconv:** yes</span>
<span class="sd">    """</span>

    <span class="n">device</span> <span class="o">=</span> <span class="n">get_processed_device_from_testfile</span><span class="p">(</span><span class="s2">"size_inheritance_and_adjustment/complex_size_adjustment.svd"</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>

    <span class="n">cluster_a</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster_a</span><span class="p">,</span> <span class="n">Cluster</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">cluster_a</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"ClusterA"</span>
    <span class="k">assert</span> <span class="n">cluster_a</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x0</span>
    <span class="k">assert</span> <span class="n">cluster_a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># not set, size adjustment results in 64 from ClusterB</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_a</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster_a</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Register</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">cluster_a</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"RegisterA"</span>
    <span class="k">assert</span> <span class="n">cluster_a</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x0</span>
    <span class="k">assert</span> <span class="n">cluster_a</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># not set, effective size results in 64 from ClusterA</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster_a</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Register</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">cluster_a</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"RegisterB"</span>
    <span class="k">assert</span> <span class="n">cluster_a</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x8</span>
    <span class="k">assert</span> <span class="n">cluster_a</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># not set, effective size results in 64 from ClusterA</span>

    <span class="n">cluster_b</span> <span class="o">=</span> <span class="n">cluster_a</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster_b</span><span class="p">,</span> <span class="n">Cluster</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">cluster_b</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"ClusterB"</span>
    <span class="k">assert</span> <span class="n">cluster_b</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x10</span>
    <span class="k">assert</span> <span class="n">cluster_b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># not set, size adjustment results in 64 from RegisterB</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_b</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster_b</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Register</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">cluster_b</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"RegisterA"</span>
    <span class="k">assert</span> <span class="n">cluster_b</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x0</span>
    <span class="k">assert</span> <span class="n">cluster_b</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># not set, effective size results in 64 from ClusterB</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster_b</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Register</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">cluster_b</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"RegisterB"</span>
    <span class="k">assert</span> <span class="n">cluster_b</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x8</span>
    <span class="k">assert</span> <span class="n">cluster_b</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># explicitly set to 64</span>

    <span class="n">cluster_c</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster_c</span><span class="p">,</span> <span class="n">Cluster</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">cluster_c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"ClusterC"</span>
    <span class="k">assert</span> <span class="n">cluster_c</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x20</span>
    <span class="k">assert</span> <span class="n">cluster_c</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">32</span>  <span class="c1"># not set, size adjustment results implicit in 32 from RegisterA and RegisterB</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cluster_c</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster_c</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Register</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">cluster_c</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"RegisterA"</span>
    <span class="k">assert</span> <span class="n">cluster_c</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x0</span>
    <span class="k">assert</span> <span class="n">cluster_c</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">32</span>  <span class="c1"># not set, effective size results in 32 from ClusterC size</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cluster_c</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Register</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">cluster_c</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"RegisterB"</span>
    <span class="k">assert</span> <span class="n">cluster_c</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x8</span>
    <span class="k">assert</span> <span class="n">cluster_c</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">32</span>  <span class="c1"># not set, effective size results in 32 from ClusterC size</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Register</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"RegisterA"</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x30</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># not set, ef. size results in 64 from peripheral</span>
</code></pre></div></td></tr></table></div>
</details><details class="quote"><summary>SVD file: <code>size_inheritance_and_adjustment/complex_size_adjustment.svd</code></summary><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><code><span class="cp">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="nt">&lt;device</span><span class="w"> </span><span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="w"> </span><span class="na">xs:noNamespaceSchemaLocation=</span><span class="s">"CMSIS-SVD.xsd"</span><span class="w"> </span><span class="na">schemaVersion=</span><span class="s">"1.3"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>complex_size_adjustment<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
<span class="w">  </span><span class="nt">&lt;description&gt;</span>Test_Example<span class="w"> </span>device<span class="nt">&lt;/description&gt;</span>
<span class="w">  </span><span class="nt">&lt;cpu&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>CM0<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;revision&gt;</span>r0p0<span class="nt">&lt;/revision&gt;</span>
<span class="w">  </span><span class="nt">&lt;endian&gt;</span>little<span class="nt">&lt;/endian&gt;</span>
<span class="w">  </span><span class="nt">&lt;mpuPresent&gt;</span>false<span class="nt">&lt;/mpuPresent&gt;</span>
<span class="w">  </span><span class="nt">&lt;fpuPresent&gt;</span>false<span class="nt">&lt;/fpuPresent&gt;</span>
<span class="w">  </span><span class="nt">&lt;nvicPrioBits&gt;</span>4<span class="nt">&lt;/nvicPrioBits&gt;</span>
<span class="w">  </span><span class="nt">&lt;vendorSystickConfig&gt;</span>false<span class="nt">&lt;/vendorSystickConfig&gt;</span>
<span class="w">  </span><span class="nt">&lt;/cpu&gt;</span>
<span class="w">  </span><span class="nt">&lt;addressUnitBits&gt;</span>8<span class="nt">&lt;/addressUnitBits&gt;</span>
<span class="w">  </span><span class="nt">&lt;width&gt;</span>32<span class="nt">&lt;/width&gt;</span>
<span class="w">  </span><span class="nt">&lt;peripherals&gt;</span>
<span class="w">    </span><span class="nt">&lt;peripheral&gt;</span>
<span class="w">      </span><span class="nt">&lt;name&gt;</span>PeripheralA<span class="nt">&lt;/name&gt;</span>
<span class="w">      </span><span class="nt">&lt;baseAddress&gt;</span>0x40001000<span class="nt">&lt;/baseAddress&gt;</span>
<span class="w">      </span><span class="nt">&lt;addressBlock&gt;</span>
<span class="w">        </span><span class="nt">&lt;offset&gt;</span>0x0<span class="nt">&lt;/offset&gt;</span>
<span class="w">        </span><span class="nt">&lt;size&gt;</span>0x1000<span class="nt">&lt;/size&gt;</span>
<span class="w">        </span><span class="nt">&lt;usage&gt;</span>registers<span class="nt">&lt;/usage&gt;</span>
<span class="w">      </span><span class="nt">&lt;/addressBlock&gt;</span>
<span class="w">      </span><span class="nt">&lt;registers&gt;</span>
<span class="w">        </span><span class="nt">&lt;cluster&gt;</span>
<span class="w">          </span><span class="nt">&lt;name&gt;</span>ClusterA<span class="nt">&lt;/name&gt;</span>
<span class="w">          </span><span class="nt">&lt;description&gt;</span>ClusterA<span class="w"> </span>description<span class="nt">&lt;/description&gt;</span>
<span class="w">          </span><span class="nt">&lt;addressOffset&gt;</span>0x0<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">          </span><span class="nt">&lt;register&gt;</span>
<span class="w">            </span><span class="nt">&lt;name&gt;</span>RegisterA<span class="nt">&lt;/name&gt;</span>
<span class="w">            </span><span class="nt">&lt;addressOffset&gt;</span>0x0<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">          </span><span class="nt">&lt;/register&gt;</span>
<span class="w">          </span><span class="nt">&lt;register&gt;</span>
<span class="w">            </span><span class="nt">&lt;name&gt;</span>RegisterB<span class="nt">&lt;/name&gt;</span>
<span class="w">            </span><span class="nt">&lt;addressOffset&gt;</span>0x8<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">          </span><span class="nt">&lt;/register&gt;</span>
<span class="w">          </span><span class="nt">&lt;cluster&gt;</span>
<span class="w">            </span><span class="nt">&lt;name&gt;</span>ClusterB<span class="nt">&lt;/name&gt;</span>
<span class="w">            </span><span class="nt">&lt;description&gt;</span>ClusterB<span class="w"> </span>description<span class="nt">&lt;/description&gt;</span>
<span class="w">            </span><span class="nt">&lt;addressOffset&gt;</span>0x10<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">            </span><span class="nt">&lt;register&gt;</span>
<span class="w">              </span><span class="nt">&lt;name&gt;</span>RegisterA<span class="nt">&lt;/name&gt;</span>
<span class="w">              </span><span class="nt">&lt;addressOffset&gt;</span>0x0<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">            </span><span class="nt">&lt;/register&gt;</span>
<span class="w">            </span><span class="nt">&lt;register&gt;</span>
<span class="w">              </span><span class="nt">&lt;name&gt;</span>RegisterB<span class="nt">&lt;/name&gt;</span>
<span class="w">              </span><span class="nt">&lt;addressOffset&gt;</span>0x8<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">              </span><span class="nt">&lt;size&gt;</span>64<span class="nt">&lt;/size&gt;</span>
<span class="w">            </span><span class="nt">&lt;/register&gt;</span>
<span class="w">          </span><span class="nt">&lt;/cluster&gt;</span>
<span class="w">        </span><span class="nt">&lt;/cluster&gt;</span>
<span class="w">        </span><span class="nt">&lt;cluster&gt;</span>
<span class="w">          </span><span class="nt">&lt;name&gt;</span>ClusterC<span class="nt">&lt;/name&gt;</span>
<span class="w">          </span><span class="nt">&lt;description&gt;</span>ClusterC<span class="w"> </span>description<span class="nt">&lt;/description&gt;</span>
<span class="w">          </span><span class="nt">&lt;addressOffset&gt;</span>0x20<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">          </span><span class="nt">&lt;register&gt;</span>
<span class="w">            </span><span class="nt">&lt;name&gt;</span>RegisterA<span class="nt">&lt;/name&gt;</span>
<span class="w">            </span><span class="nt">&lt;addressOffset&gt;</span>0x0<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">          </span><span class="nt">&lt;/register&gt;</span>
<span class="w">          </span><span class="nt">&lt;register&gt;</span>
<span class="w">            </span><span class="nt">&lt;name&gt;</span>RegisterB<span class="nt">&lt;/name&gt;</span>
<span class="w">            </span><span class="nt">&lt;addressOffset&gt;</span>0x8<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">          </span><span class="nt">&lt;/register&gt;</span>
<span class="w">        </span><span class="nt">&lt;/cluster&gt;</span>
<span class="w">        </span><span class="nt">&lt;register&gt;</span>
<span class="w">          </span><span class="nt">&lt;name&gt;</span>RegisterA<span class="nt">&lt;/name&gt;</span>
<span class="w">          </span><span class="nt">&lt;addressOffset&gt;</span>0x30<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">        </span><span class="nt">&lt;/register&gt;</span>
<span class="w">      </span><span class="nt">&lt;/registers&gt;</span>
<span class="w">    </span><span class="nt">&lt;/peripheral&gt;</span>
<span class="w">  </span><span class="nt">&lt;/peripherals&gt;</span>
<span class="nt">&lt;/device&gt;</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="tests.test_process.test_size_inheritance_and_adjustment.test_overlap_due_to_size_adjustment">
<code class="highlight language-python"><span class="n">test_overlap_due_to_size_adjustment</span></code>
</h2>
<div class="doc doc-contents">
<p>This test verifies how the parser handles size adjustments that lead to register overlaps. The SVD file
contains a peripheral where the size inheritance and adjustment algorithm causes an overlap between two
registers. Specifically, <code>PeripheralA</code> starts with a defined size of 32 bits, but the effective size is
adjusted to 64 bits due to the size of <code>RegisterB</code>. <code>RegisterA</code>, which does not have an explicit size,
inherits its size from the peripheral, leading to an overlap with <code>RegisterB</code>, which has an address offset of
0x4.</p>
<p><strong>Expected Outcome:</strong> The parser should process the file and issue a warning about the overlap caused by the size
adjustment. <code>PeripheralA</code> should have a final size of 64 bits, overriding the original size of 32 bits due to
the size of <code>RegisterB</code>. <code>RegisterA</code>, which does not have a size defined, should inherit the size from
<code>PeripheralA</code> and have a final size of 64 bits. This leads to an overlap with <code>RegisterB</code>, whose size is
explicitly set to 64 bits, starting at address offset 0x4. The parser should handle this case by adjusting the
sizes correctly and raising a warning due to the overlap, similar to the behavior in <code>svdconv</code>.</p>
<p><strong>Processable with svdconv:</strong> yes</p>
<details class="quote">
<summary>Source code in <code>tests/test_process/test_size_inheritance_and_adjustment.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"error::svdsuite.process.ProcessWarning"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_overlap_due_to_size_adjustment</span><span class="p">(</span><span class="n">get_processed_device_from_testfile</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Device</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    This test verifies how the parser handles size adjustments that lead to register overlaps. The SVD file</span>
<span class="sd">    contains a peripheral where the size inheritance and adjustment algorithm causes an overlap between two</span>
<span class="sd">    registers. Specifically, `PeripheralA` starts with a defined size of 32 bits, but the effective size is</span>
<span class="sd">    adjusted to 64 bits due to the size of `RegisterB`. `RegisterA`, which does not have an explicit size,</span>
<span class="sd">    inherits its size from the peripheral, leading to an overlap with `RegisterB`, which has an address offset of</span>
<span class="sd">    0x4.</span>

<span class="sd">    **Expected Outcome:** The parser should process the file and issue a warning about the overlap caused by the size</span>
<span class="sd">    adjustment. `PeripheralA` should have a final size of 64 bits, overriding the original size of 32 bits due to</span>
<span class="sd">    the size of `RegisterB`. `RegisterA`, which does not have a size defined, should inherit the size from</span>
<span class="sd">    `PeripheralA` and have a final size of 64 bits. This leads to an overlap with `RegisterB`, whose size is</span>
<span class="sd">    explicitly set to 64 bits, starting at address offset 0x4. The parser should handle this case by adjusting the</span>
<span class="sd">    sizes correctly and raising a warning due to the overlap, similar to the behavior in `svdconv`.</span>

<span class="sd">    **Processable with svdconv:** yes</span>
<span class="sd">    """</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">warns</span><span class="p">(</span><span class="n">ProcessWarning</span><span class="p">):</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">get_processed_device_from_testfile</span><span class="p">(</span>
            <span class="s2">"size_inheritance_and_adjustment/overlap_due_to_size_adjustment.svd"</span>
        <span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># explicitly set to 32, adjustment overwrite to 64 from RegisterB</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Register</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"RegisterA"</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x0</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># not set, ef. size results in 64 (PeripheralA)</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Register</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"RegisterB"</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x4</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># explicitly set to 64</span>
</code></pre></div></td></tr></table></div>
</details><details class="quote"><summary>SVD file: <code>size_inheritance_and_adjustment/overlap_due_to_size_adjustment.svd</code></summary><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><code><span class="cp">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="nt">&lt;device</span><span class="w"> </span><span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="w"> </span><span class="na">xs:noNamespaceSchemaLocation=</span><span class="s">"CMSIS-SVD.xsd"</span><span class="w"> </span><span class="na">schemaVersion=</span><span class="s">"1.3"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>overlap_due_to_size_adjustment<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
<span class="w">  </span><span class="nt">&lt;description&gt;</span>Test_Example<span class="w"> </span>device<span class="nt">&lt;/description&gt;</span>
<span class="w">  </span><span class="nt">&lt;cpu&gt;</span>
<span class="w">    </span><span class="nt">&lt;name&gt;</span>CM0<span class="nt">&lt;/name&gt;</span>
<span class="w">    </span><span class="nt">&lt;revision&gt;</span>r0p0<span class="nt">&lt;/revision&gt;</span>
<span class="w">    </span><span class="nt">&lt;endian&gt;</span>little<span class="nt">&lt;/endian&gt;</span>
<span class="w">    </span><span class="nt">&lt;mpuPresent&gt;</span>false<span class="nt">&lt;/mpuPresent&gt;</span>
<span class="w">    </span><span class="nt">&lt;fpuPresent&gt;</span>false<span class="nt">&lt;/fpuPresent&gt;</span>
<span class="w">    </span><span class="nt">&lt;nvicPrioBits&gt;</span>4<span class="nt">&lt;/nvicPrioBits&gt;</span>
<span class="w">    </span><span class="nt">&lt;vendorSystickConfig&gt;</span>false<span class="nt">&lt;/vendorSystickConfig&gt;</span>
<span class="w">  </span><span class="nt">&lt;/cpu&gt;</span>
<span class="w">  </span><span class="nt">&lt;addressUnitBits&gt;</span>8<span class="nt">&lt;/addressUnitBits&gt;</span>
<span class="w">  </span><span class="nt">&lt;width&gt;</span>32<span class="nt">&lt;/width&gt;</span>
<span class="w">  </span><span class="nt">&lt;peripherals&gt;</span>
<span class="w">    </span><span class="nt">&lt;peripheral&gt;</span>
<span class="w">      </span><span class="nt">&lt;name&gt;</span>PeripheralA<span class="nt">&lt;/name&gt;</span>
<span class="w">      </span><span class="nt">&lt;baseAddress&gt;</span>0x40001000<span class="nt">&lt;/baseAddress&gt;</span>
<span class="w">      </span><span class="nt">&lt;size&gt;</span>32<span class="nt">&lt;/size&gt;</span>
<span class="w">      </span><span class="nt">&lt;addressBlock&gt;</span>
<span class="w">        </span><span class="nt">&lt;offset&gt;</span>0x0<span class="nt">&lt;/offset&gt;</span>
<span class="w">        </span><span class="nt">&lt;size&gt;</span>0x1000<span class="nt">&lt;/size&gt;</span>
<span class="w">        </span><span class="nt">&lt;usage&gt;</span>registers<span class="nt">&lt;/usage&gt;</span>
<span class="w">      </span><span class="nt">&lt;/addressBlock&gt;</span>
<span class="w">      </span><span class="nt">&lt;registers&gt;</span>
<span class="w">        </span><span class="nt">&lt;register&gt;</span>
<span class="w">          </span><span class="nt">&lt;name&gt;</span>RegisterA<span class="nt">&lt;/name&gt;</span>
<span class="w">          </span><span class="nt">&lt;addressOffset&gt;</span>0x0<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">        </span><span class="nt">&lt;/register&gt;</span>
<span class="w">        </span><span class="nt">&lt;register&gt;</span>
<span class="w">          </span><span class="nt">&lt;name&gt;</span>RegisterB<span class="nt">&lt;/name&gt;</span>
<span class="w">          </span><span class="nt">&lt;addressOffset&gt;</span>0x4<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">          </span><span class="nt">&lt;size&gt;</span>64<span class="nt">&lt;/size&gt;</span>
<span class="w">        </span><span class="nt">&lt;/register&gt;</span>
<span class="w">      </span><span class="nt">&lt;/registers&gt;</span>
<span class="w">    </span><span class="nt">&lt;/peripheral&gt;</span>
<span class="w">  </span><span class="nt">&lt;/peripherals&gt;</span>
<span class="nt">&lt;/device&gt;</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="tests.test_process.test_size_inheritance_and_adjustment.test_simple_size_adjustment">
<code class="highlight language-python"><span class="n">test_simple_size_adjustment</span></code>
</h2>
<div class="doc doc-contents">
<p>This test evaluates how the parser handles simple size inheritance and explicit size adjustments within a
peripheral. In this scenario, the peripheral has both implicit and explicit size definitions, and the parser
must adjust these sizes based on the rules described. Specifically, <code>RegisterA</code> has no explicit size set, so
it should inherit the size from the peripheral level, while <code>RegisterB</code> has an explicit size defined.
<code>svdconv</code> processes this file correctly, applying size adjustments based on the highest level's explicit
settings.</p>
<p><strong>Expected Outcome:</strong> The parser should correctly adjust the sizes, processing the SVD file without errors. The
peripheral should have two registers, <code>RegisterA</code> and <code>RegisterB</code>. The overall size of the peripheral should
be set to 64 bits, which overrides the explicit 16-bit setting due to size adjustments. <code>RegisterA</code>, with no
explicit size set, should inherit the peripheral's size and be 64 bits. <code>RegisterB</code>, which explicitly has a
size of 64 bits, should retain this size. The parser should process the inheritance and size adjustment
algorithm correctly, reflecting the behavior of <code>svdconv</code>.</p>
<p><strong>Processable with svdconv:</strong> yes</p>
<details class="quote">
<summary>Source code in <code>tests/test_process/test_size_inheritance_and_adjustment.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"error::svdsuite.process.ProcessWarning"</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_simple_size_adjustment</span><span class="p">(</span><span class="n">get_processed_device_from_testfile</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Device</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    This test evaluates how the parser handles simple size inheritance and explicit size adjustments within a</span>
<span class="sd">    peripheral. In this scenario, the peripheral has both implicit and explicit size definitions, and the parser</span>
<span class="sd">    must adjust these sizes based on the rules described. Specifically, `RegisterA` has no explicit size set, so</span>
<span class="sd">    it should inherit the size from the peripheral level, while `RegisterB` has an explicit size defined.</span>
<span class="sd">    `svdconv` processes this file correctly, applying size adjustments based on the highest level's explicit</span>
<span class="sd">    settings.</span>

<span class="sd">    **Expected Outcome:** The parser should correctly adjust the sizes, processing the SVD file without errors. The</span>
<span class="sd">    peripheral should have two registers, `RegisterA` and `RegisterB`. The overall size of the peripheral should</span>
<span class="sd">    be set to 64 bits, which overrides the explicit 16-bit setting due to size adjustments. `RegisterA`, with no</span>
<span class="sd">    explicit size set, should inherit the peripheral's size and be 64 bits. `RegisterB`, which explicitly has a</span>
<span class="sd">    size of 64 bits, should retain this size. The parser should process the inheritance and size adjustment</span>
<span class="sd">    algorithm correctly, reflecting the behavior of `svdconv`.</span>

<span class="sd">    **Processable with svdconv:** yes</span>
<span class="sd">    """</span>

    <span class="n">device</span> <span class="o">=</span> <span class="n">get_processed_device_from_testfile</span><span class="p">(</span><span class="s2">"size_inheritance_and_adjustment/simple_size_adjustment.svd"</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># explicitly set to 16, adjustment overwrite to 64</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Register</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"RegisterA"</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x0</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># not set, effective size results in 64</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Register</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"RegisterB"</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">address_offset</span> <span class="o">==</span> <span class="mh">0x8</span>
    <span class="k">assert</span> <span class="n">device</span><span class="o">.</span><span class="n">peripherals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">registers_clusters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">64</span>  <span class="c1"># explicitly set to 64</span>
</code></pre></div></td></tr></table></div>
</details><details class="quote"><summary>SVD file: <code>size_inheritance_and_adjustment/simple_size_adjustment.svd</code></summary><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><code><span class="cp">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span>
<span class="nt">&lt;device</span><span class="w"> </span><span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="w"> </span><span class="na">xs:noNamespaceSchemaLocation=</span><span class="s">"CMSIS-SVD.xsd"</span><span class="w"> </span><span class="na">schemaVersion=</span><span class="s">"1.3"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>simple_size_adjustment<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
<span class="w">  </span><span class="nt">&lt;description&gt;</span>Test_Example<span class="w"> </span>device<span class="nt">&lt;/description&gt;</span>
<span class="w">  </span><span class="nt">&lt;cpu&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>CM0<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;revision&gt;</span>r0p0<span class="nt">&lt;/revision&gt;</span>
<span class="w">  </span><span class="nt">&lt;endian&gt;</span>little<span class="nt">&lt;/endian&gt;</span>
<span class="w">  </span><span class="nt">&lt;mpuPresent&gt;</span>false<span class="nt">&lt;/mpuPresent&gt;</span>
<span class="w">  </span><span class="nt">&lt;fpuPresent&gt;</span>false<span class="nt">&lt;/fpuPresent&gt;</span>
<span class="w">  </span><span class="nt">&lt;nvicPrioBits&gt;</span>4<span class="nt">&lt;/nvicPrioBits&gt;</span>
<span class="w">  </span><span class="nt">&lt;vendorSystickConfig&gt;</span>false<span class="nt">&lt;/vendorSystickConfig&gt;</span>
<span class="w">  </span><span class="nt">&lt;/cpu&gt;</span>
<span class="w">  </span><span class="nt">&lt;addressUnitBits&gt;</span>8<span class="nt">&lt;/addressUnitBits&gt;</span>
<span class="w">  </span><span class="nt">&lt;width&gt;</span>32<span class="nt">&lt;/width&gt;</span>
<span class="w">  </span><span class="nt">&lt;peripherals&gt;</span>
<span class="w">  </span><span class="nt">&lt;peripheral&gt;</span>
<span class="w">    </span><span class="nt">&lt;name&gt;</span>PeripheralA<span class="nt">&lt;/name&gt;</span>
<span class="w">    </span><span class="nt">&lt;baseAddress&gt;</span>0x40001000<span class="nt">&lt;/baseAddress&gt;</span>
<span class="w">    </span><span class="nt">&lt;size&gt;</span>16<span class="nt">&lt;/size&gt;</span>
<span class="w">    </span><span class="nt">&lt;addressBlock&gt;</span>
<span class="w">    </span><span class="nt">&lt;offset&gt;</span>0x0<span class="nt">&lt;/offset&gt;</span>
<span class="w">    </span><span class="nt">&lt;size&gt;</span>0x1000<span class="nt">&lt;/size&gt;</span>
<span class="w">    </span><span class="nt">&lt;usage&gt;</span>registers<span class="nt">&lt;/usage&gt;</span>
<span class="w">    </span><span class="nt">&lt;/addressBlock&gt;</span>
<span class="w">    </span><span class="nt">&lt;registers&gt;</span>
<span class="w">    </span><span class="nt">&lt;register&gt;</span>
<span class="w">      </span><span class="nt">&lt;name&gt;</span>RegisterA<span class="nt">&lt;/name&gt;</span>
<span class="w">      </span><span class="nt">&lt;addressOffset&gt;</span>0x0<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">    </span><span class="nt">&lt;/register&gt;</span>
<span class="w">    </span><span class="nt">&lt;register&gt;</span>
<span class="w">      </span><span class="nt">&lt;name&gt;</span>RegisterB<span class="nt">&lt;/name&gt;</span>
<span class="w">      </span><span class="nt">&lt;addressOffset&gt;</span>0x8<span class="nt">&lt;/addressOffset&gt;</span>
<span class="w">      </span><span class="nt">&lt;size&gt;</span>64<span class="nt">&lt;/size&gt;</span>
<span class="w">    </span><span class="nt">&lt;/register&gt;</span>
<span class="w">    </span><span class="nt">&lt;/registers&gt;</span>
<span class="w">  </span><span class="nt">&lt;/peripheral&gt;</span>
<span class="w">  </span><span class="nt">&lt;/peripherals&gt;</span>
<span class="nt">&lt;/device&gt;</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>